(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{688:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"docker-compose-概述与安装？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-概述与安装？"}},[s._v("#")]),s._v(" Docker Compose 概述与安装？")]),s._v(" "),e("ul",[e("li",[s._v("前面我们使用 Docker 的时候，定义 Dockerfile 文件，然后使用 docker build、docker run 等命令操作容器。然而微服务架构的应用系统一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，那么效率之低，维护量之大可想而知")]),s._v(" "),e("li",[e("strong",[s._v("使用 Docker Compose 可以轻松、高效的管理容器，它是一个用于定义和运行多容器 Docker 的应用程序工具")])])]),s._v(" "),e("h3",{attrs:{id:"安装-docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker-compose"}},[s._v("#")]),s._v(" 安装 Docker Compose")]),s._v(" "),e("ul",[e("li",[s._v("安装 Docker Compose 可以通过下面命令自动下载适应版本的 Compose，并为安装脚本添加执行权限")])]),s._v(" "),e("div",{staticClass:"language-ruby line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[s._v("sudo curl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("L")]),s._v(" https"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.21")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uname "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uname "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\nsudo chmod "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("查看安装是否成功")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose -v\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"快速入门"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[s._v("#")]),s._v(" 快速入门")]),s._v(" "),e("ul",[e("li",[s._v("打包项目，获得 jar 包 docker-demo-0.0.1-SNAPSHOT.jar")])]),s._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[s._v("mvn clean "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在 jar 包所在路径创建 Dockerfile 文件，添加以下内容")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("FROM java:8\nVOLUME /tmp\nADD docker-demo-0.0.1-SNAPSHOT.jar app.jar\nRUN "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'touch /app.jar'")]),s._v("\nEXPOSE "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\nENTRYPOINT "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.egd=file:/dev/./urandom"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.jar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("在 jar 包所在路径创建文件 docker-compose.yml，添加以下内容")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("version: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示该 Docker-Compose 文件使用的是 Version 2 file")]),s._v("\nservices:\n  docker-demo:  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定服务名称")]),s._v("\n    build: "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 Dockerfile 所在路径")]),s._v("\n    ports:    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定端口映射")]),s._v("\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9000:8761"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("在 docker-compose.yml 所在路径下执行该命令 Compose 就会自动构建镜像并使用镜像启动容器")])]),s._v(" "),e("div",{staticClass:"language-cpp line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-cpp"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose up\ndocker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose up "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 后台启动并运行容器")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("访问 http://localhost:9000/hello 即可访问微服务接口")])]),s._v(" "),e("h3",{attrs:{id:"工程、服务、容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工程、服务、容器"}},[s._v("#")]),s._v(" 工程、服务、容器")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("Docker Compose 将所管理的容器分为三层，分别是工程（project）、服务（service）、容器（container）")])]),s._v(" "),e("li",[e("strong",[s._v("Docker Compose 运行目录下的所有文件（docker-compose.yml）组成一个工程,一个工程包含多个服务，每个服务中定义了容器运行的镜像、参数、依赖，一个服务可包括多个容器实例")])])]),s._v(" "),e("h2",{attrs:{id:"docker-compose-常用命令与配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-常用命令与配置"}},[s._v("#")]),s._v(" Docker Compose 常用命令与配置")]),s._v(" "),e("h3",{attrs:{id:"常见命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见命令"}},[s._v("#")]),s._v(" 常见命令")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("ps")]),s._v("：列出所有运行容器")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose ps\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("logs")]),s._v("：查看服务日志输出")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose logs\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("port")]),s._v("：打印绑定的公共端口，下面命令可以输出 eureka 服务 8761 端口所绑定的公共端口")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose port eureka 8761\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("build")]),s._v("：构建或者重新构建服务")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose build\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("start")]),s._v("：启动指定服务已存在的容器")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose start eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("stop")]),s._v("：停止已运行的服务的容器")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose stop eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("rm")]),s._v("：删除指定服务的容器")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose rm eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("up")]),s._v("：构建、启动容器")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("kill")]),s._v("：通过发送 SIGKILL 信号来停止指定服务的容器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("pull")]),s._v("：下载服务镜像")]),s._v(" "),e("li",[e("strong",[s._v("scale")]),s._v("：设置指定服务运气容器的个数，以 service=num 形式指定")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose scale user=3 movie=3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("run")]),s._v("：在一个服务上执行一个命令")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose run web bash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"docker-compose-yml-属性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml-属性"}},[s._v("#")]),s._v(" docker-compose.yml 属性")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("version")]),s._v("：指定 docker-compose.yml 文件的写法格式")]),s._v(" "),e("li",[e("strong",[s._v("services")]),s._v("：多个容器集合")]),s._v(" "),e("li",[e("strong",[s._v("build")]),s._v("：配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build: ./dir\n---------------\nbuild:\n    context: ./dir\n    dockerfile: Dockerfile\n    args:\n        buildno: 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("command")]),s._v("：覆盖容器启动后默认执行的命令")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("command: bundle "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" thin -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n----------------------------------\ncommand: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bundle,exec,thin,-p,3000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("dns")]),s._v("：配置 dns 服务器，可以是一个值或列表")])]),s._v(" "),e("div",{staticClass:"language-css line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("dns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 8.8.8.8\n------------\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("dns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    - 8.8.8.8\n    - 9.9.9.9\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("dns_search")]),s._v("：配置 DNS 搜索域，可以是一个值或列表")])]),s._v(" "),e("div",{staticClass:"language-css line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("dns_search")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example.com\n------------------------\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("dns_search")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    - dc1.example.com\n    - dc2.example.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("environment")]),s._v("：环境变量配置，可以用数组或字典两种方式")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("environment:\n    RACK_ENV: development\n    SHOW: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ture'")]),s._v("\n-------------------------\nenvironment:\n    - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RACK_ENV")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("development\n    - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SHOW")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ture\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("env_file")]),s._v("：从文件中获取环境变量，可以指定一个文件路径或路径列表，其优先级低于 environment 指定的环境变量")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("env_file: .env\n---------------\nenv_file:\n    - ./common.env\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("expose")]),s._v("：暴露端口，只将端口暴露给连接的服务，而不暴露给主机")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("expose:\n    - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000"')]),s._v("\n    - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8000"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("image")]),s._v("：指定服务所使用的镜像")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("image: java\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("network_mode")]),s._v("：设置网络模式")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("network_mode: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v("\nnetwork_mode: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v("\nnetwork_mode: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v("\nnetwork_mode: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service:[service name]"')]),s._v("\nnetwork_mode: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"container:[container name/id]"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("ports")]),s._v("：对外暴露的端口定义，和 expose 对应")])]),s._v(" "),e("div",{staticClass:"language-objectivec line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-objectivec"}},[e("code",[s._v("ports"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("   # 暴露端口信息  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"宿主机端口:容器暴露端口"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8763:8763"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8763:8763"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("links")]),s._v("：将指定容器连接到当前连接，可以设置别名，避免ip方式导致的容器重启动态改变的无法连接情况")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("links:    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定服务名称:别名 ")]),s._v("\n    - docker-compose-eureka-server:compose-eureka\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("volumes")]),s._v("：卷挂载路径")])]),s._v(" "),e("div",{staticClass:"language-csharp line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[s._v("volumes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("logs")]),s._v("：日志输出信息")])]),s._v(" "),e("div",{staticClass:"language-undefined line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("--no-color          单色输出，不显示其他颜.\n-f, --follow        跟踪日志输出，就是可以实时查看日志\n-t, --timestamps    显示时间戳\n--tail              从日志的结尾显示，--tail=200\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"docker-compose-其它"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-其它"}},[s._v("#")]),s._v(" Docker Compose 其它")]),s._v(" "),e("h3",{attrs:{id:"更新容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新容器"}},[s._v("#")]),s._v(" 更新容器")]),s._v(" "),e("ul",[e("li",[s._v("当服务的配置发生更改时，可使用 docker-compose up 命令更新配置")]),s._v(" "),e("li",[s._v("此时，Compose 会删除旧容器并创建新容器，新容器会以不同的 IP 地址加入网络，名称保持不变，任何指向旧容起的连接都会被关闭，重新找到新容器并连接上去")])]),s._v(" "),e("h3",{attrs:{id:"links"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[s._v("#")]),s._v(" links")]),s._v(" "),e("ul",[e("li",[s._v("服务之间可以使用服务名称相互访问，links 允许定义一个别名，从而使用该别名访问其它服务")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("version: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n    web:\n        build: "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n        links:\n            - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db:database"')]),s._v("\n    db:\n        image: postgres\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("这样 Web 服务就可以使用 db 或 database 作为 hostname 访问 db 服务了")])])])}),[],!1,null,null,null);a.default=t.exports}}]);