(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{799:function(e,t,r){"use strict";r.r(t);var a=r(4),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"概述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),r("p",[e._v("ID号生成器（或：全局唯一ID生成器）是服务端系统的基础设施，而且ID号这个东西基本搞后端开发的程序员天天都要接触。而关于ID生成的算法现在业界首屈一指的当属"),r("code",[e._v("Snowflake")]),e._v("雪花算法。")]),e._v(" "),r("p",[r("code",[e._v("UidGenerator")]),e._v("正是百度开源的一款基于"),r("code",[e._v("Snowflake")]),e._v("雪花算法实现的高性能唯一ID生成器。在本号前文中已经详细使用过"),r("code",[e._v("UidGenerator")]),e._v("，但使用过程还是比较繁杂，还需要自己去引"),r("code",[e._v("UidGenerator")]),e._v("组件的源码，感觉有点不方便。为此本文基于"),r("code",[e._v("UidGenerator")]),e._v("，再来封装一套更利于"),r("code",[e._v("Spring Boot")]),e._v("项目使用的"),r("code",[e._v("ID")]),e._v("号生成组件，命名为"),r("code",[e._v("id-spring-boot-starter")]),e._v("，一看名字就知道是开箱即用的。")]),e._v(" "),r("hr"),e._v(" "),r("h2",{attrs:{id:"用法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[e._v("#")]),e._v(" 用法")]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("导入SQL脚本")])])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("DROP TABLE IF EXISTS WORKER_NODE;CREATE TABLE WORKER_NODE(ID BIGINT NOT NULL AUTO_INCREMENT COMMENT 'auto increment id',HOST_NAME VARCHAR(64) NOT NULL COMMENT 'host name',PORT VARCHAR(64) NOT NULL COMMENT 'port',TYPE INT NOT NULL COMMENT 'node type: ACTUAL or CONTAINER',LAUNCH_DATE DATE NOT NULL COMMENT 'launch date',MODIFIED TIMESTAMP NOT NULL COMMENT 'modified time',CREATED TIMESTAMP NOT NULL COMMENT 'created time',PRIMARY KEY(ID)) COMMENT='DB WorkerID Assigner for UID Generator',ENGINE = INNODB;\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("这一步肯定是省不掉，毕竟"),r("code",[e._v("UidGenerator")]),e._v("需要数据库支持")]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("pom中加入依赖")])])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("<dependency>\t<groupId>cn.codesheep</groupId>\t<artifactId>id-spring-boot-starter</artifactId>\t<version>1.0.0</version></dependency>\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("ul",[r("li",[r("strong",[e._v("配置数据库连接")])])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("url: jdbc:mysql://xxx.xxx.xxx.xxx:3306/demo?useUnicode=true&characterEncoding=utf8&autoReconnect=true&useOldAliasMetadataBehavior=true&connectionCollation=utf8mb4_unicode_ci&rewriteBatchedStatements=true&allowMultiQueries=trueusername: xxxxxxpassword: xxxxxx\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("还是因为"),r("code",[e._v("UidGenerator")]),e._v("需要数据库支持")]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("修改Spring Boot主类")])])]),e._v(" "),r("p",[e._v("Spring Boot应用主类上加上"),r("code",[e._v("mybatis")]),e._v("注解即可：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('@MapperScan({"com.baidu.fsg.uid.worker.dao"})\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("ul",[r("li",[r("strong",[e._v("代码使用方式")])])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('@RestControllerpublic class TestController {  @Autowired  private UidGenService uidGenService;  @GetMapping("/uid")  public String genUid() {    return String.valueOf("本次生成的唯一ID号为："+uidGenService.getUid());  }}\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("怎么样，用法超级简单吧：")]),e._v(" "),r("ol",[r("li",[e._v("首先用 "),r("code",[e._v("Autowired")]),e._v("的方式引入"),r("code",[e._v("UidGenService")]),e._v("类；")]),e._v(" "),r("li",[e._v("直接调用"),r("code",[e._v("UidGenService")]),e._v("类的"),r("code",[e._v("getUid()")]),e._v("方法即可获得一个"),r("code",[e._v("Long")]),e._v("型的 "),r("code",[e._v("ID")]),e._v("号")])]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("运行效果")])])]),e._v(" "),r("p",[r("a",{attrs:{href:"https://raw.githubusercontent.com/hansonwang99/pic/master/id-springbt-starter/result.JPG",target:"_blank",rel:"noopener noreferrer"}},[r("img",{attrs:{src:"https://raw.githubusercontent.com/hansonwang99/pic/master/id-springbt-starter/result.JPG",alt:"运行效果"}}),r("OutboundLink")],1),e._v("运行效果")]),e._v(" "),r("p",[r("code",[e._v("demo")]),e._v("源码在此，需要请自提：")]),e._v(" "),r("ul",[r("li",[e._v("https://github.com/hansonwang99/Spring-Boot-In-Action/tree/master/test-id-spring-boot-starter")])]),e._v(" "),r("hr"),e._v(" "),r("h2",{attrs:{id:"id-spring-boot-starter源码下载"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#id-spring-boot-starter源码下载"}},[e._v("#")]),e._v(" id-spring-boot-starter源码下载")]),e._v(" "),r("p",[e._v("需要组件"),r("code",[e._v("id-spring-boot-starter")]),e._v("源码进行自定制的，可以去"),r("code",[e._v("github")]),e._v("上自行下载源代码，地址在此：")]),e._v(" "),r("ul",[r("li",[e._v("https://github.com/hansonwang99/Spring-Boot-In-Action/tree/master/id-spring-boot-starter")])]),e._v(" "),r("hr"),e._v(" "),r("h2",{attrs:{id:"几个注意点："}},[r("a",{staticClass:"header-anchor",attrs:{href:"#几个注意点："}},[e._v("#")]),e._v(" 几个注意点：")]),e._v(" "),r("ul",[r("li",[e._v("由于"),r("code",[e._v("UidGenerator")]),e._v("需要数据库支持，因此使用前一定要导数据表，并且要配置"),r("code",[e._v("MapperScan")])]),e._v(" "),r("li",[e._v("需要高度定制"),r("code",[e._v("UidGenerator")]),e._v("组件详情的，可以自行修改"),r("code",[e._v("id-spring-boot-starter")]),e._v("内部的"),r("code",[e._v("cached-uid-spring.xml")]),e._v("文件，然后重新打"),r("code",[e._v("jar")]),e._v("包")]),e._v(" "),r("li",[e._v("由于"),r("code",[e._v("ID")]),e._v("号生成一般属于系统基础服务，因此可以独立成一个微服务，供其他微服务调用")])]),e._v(" "),r("p",[e._v("原文来源于"),r("a",{attrs:{href:"https://www.codesheep.cn/2019/09/04/id-springbt-starter/",target:"_blank",rel:"noopener noreferrer"}},[e._v("封装一个流水号ID生成器：id-spring-boot-starter"),r("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);