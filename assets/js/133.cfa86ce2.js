(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{777:function(s,e,a){"use strict";a.r(e);var n=a(4),r=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("code",[s._v("Redis")]),s._v(" 是一种基于 "),a("strong",[s._v("键值对")]),s._v(" 的 "),a("code",[s._v("NoSQL")]),s._v(" 数据库。与很多键值对数据库不同，"),a("code",[s._v("Redis")]),s._v(" 提供了丰富的 "),a("strong",[s._v("值数据存储结构")]),s._v("，包括 "),a("code",[s._v("string")]),s._v("("),a("strong",[s._v("字符串")]),s._v(")、"),a("code",[s._v("hash")]),s._v("("),a("strong",[s._v("哈希")]),s._v(")、"),a("code",[s._v("list")]),s._v("("),a("strong",[s._v("列表")]),s._v(")、"),a("code",[s._v("set")]),s._v("("),a("strong",[s._v("集合")]),s._v(")、"),a("code",[s._v("zset")]),s._v("("),a("strong",[s._v("有序集合")]),s._v(")、"),a("code",[s._v("bitmap")]),s._v("("),a("strong",[s._v("位图")]),s._v(")等等。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chenyeshen.oss-cn-shenzhen.aliyuncs.com/oneblog/article/20191203100932812.png",alt:"img"}})]),s._v(" "),a("h1",{attrs:{id:"正文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正文"}},[s._v("#")]),s._v(" 正文")]),s._v(" "),a("p",[a("code",[s._v("Redis")]),s._v(" 是一个使用 "),a("code",[s._v("ANSI C")]),s._v(" 编写的开源、支持 "),a("strong",[s._v("网络")]),s._v("、基于 "),a("strong",[s._v("内存")]),s._v("、"),a("strong",[s._v("单线程模型")]),s._v("、"),a("strong",[s._v("可选持久性")]),s._v(" 的 "),a("strong",[s._v("键值对存储数据库")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_1-redis的特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis的特性"}},[s._v("#")]),s._v(" 1. Redis的特性")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("速度快")]),s._v("，最快可达到 "),a("code",[s._v("10w QPS")]),s._v("（基于 "),a("strong",[s._v("内存")]),s._v("，"),a("code",[s._v("C")]),s._v(" 语言，"),a("strong",[s._v("单线程")]),s._v(" 架构）；")]),s._v(" "),a("li",[s._v("基于 "),a("strong",[s._v("键值对")]),s._v(" ("),a("code",[s._v("key/value")]),s._v(") 的数据结构服务器。全称 "),a("code",[s._v("Remote Dictionary Server")]),s._v("。包括 "),a("code",[s._v("string")]),s._v("("),a("strong",[s._v("字符串")]),s._v(")、"),a("code",[s._v("hash")]),s._v("("),a("strong",[s._v("哈希")]),s._v(")、"),a("code",[s._v("list")]),s._v("("),a("strong",[s._v("列表")]),s._v(")、"),a("code",[s._v("set")]),s._v("("),a("strong",[s._v("集合")]),s._v(")、"),a("code",[s._v("zset")]),s._v("("),a("strong",[s._v("有序集合")]),s._v(")、"),a("code",[s._v("bitmap")]),s._v("("),a("strong",[s._v("位图")]),s._v(")。同时在 "),a("strong",[s._v("字符串")]),s._v(" 的基础上演变出 "),a("strong",[s._v("位图")]),s._v("（"),a("code",[s._v("BitMaps")]),s._v("）和 "),a("code",[s._v("HyperLogLog")]),s._v(" 两种数据结构。"),a("code",[s._v("3.2")]),s._v(" 版本中加入 "),a("code",[s._v("GEO")]),s._v("（"),a("strong",[s._v("地理信息位置")]),s._v("）。")]),s._v(" "),a("li",[s._v("丰富的功能。例如："),a("strong",[s._v("键过期")]),s._v("（缓存），"),a("strong",[s._v("发布订阅")]),s._v("（消息队列）， "),a("code",[s._v("Lua")]),s._v(" 脚本（自己实现 "),a("code",[s._v("Redis")]),s._v(" 命令），"),a("strong",[s._v("事务")]),s._v("，"),a("strong",[s._v("流水线")]),s._v("（"),a("code",[s._v("Pipeline")]),s._v("，用于减少网络开销）。")]),s._v(" "),a("li",[s._v("简单稳定。无外部库依赖，单线程模型。")]),s._v(" "),a("li",[s._v("客户端语言多。")]),s._v(" "),a("li",[a("strong",[s._v("持久化")]),s._v("（支持两种 "),a("strong",[s._v("持久化")]),s._v(" 方式 "),a("code",[s._v("RDB")]),s._v(" 和 "),a("code",[s._v("AOF")]),s._v("）。")]),s._v(" "),a("li",[a("strong",[s._v("主从复制")]),s._v("（分布式的基础）。")]),s._v(" "),a("li",[a("strong",[s._v("高可用")]),s._v("（"),a("code",[s._v("Redis Sentinel")]),s._v("），"),a("strong",[s._v("分布式")]),s._v("（"),a("code",[s._v("Redis Cluster")]),s._v("）和 "),a("strong",[s._v("水平扩容")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"_2-redis的应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis的应用场景"}},[s._v("#")]),s._v(" 2. Redis的应用场景")]),s._v(" "),a("h3",{attrs:{id:"_2-1-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-缓存"}},[s._v("#")]),s._v(" 2.1. 缓存")]),s._v(" "),a("p",[s._v("合理的使用 "),a("strong",[s._v("缓存")]),s._v(" 能够明显加快访问的速度，同时降低数据源的压力。这也是 "),a("code",[s._v("Redis")]),s._v(" 最常用的功能。"),a("code",[s._v("Redis")]),s._v(" 提供了 "),a("strong",[s._v("键值过期时间")]),s._v("（"),a("code",[s._v("EXPIRE key seconds")]),s._v("）设置，并且也提供了灵活控制 "),a("strong",[s._v("最大内存")]),s._v(" 和 "),a("strong",[s._v("内存溢出")]),s._v(" 后的 "),a("strong",[s._v("淘汰策略")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_2-2-排行榜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-排行榜"}},[s._v("#")]),s._v(" 2.2. 排行榜")]),s._v(" "),a("p",[s._v("每个网站都有自己的排行榜，例如按照 "),a("strong",[s._v("热度排名")]),s._v(" 的排行榜，"),a("strong",[s._v("发布时间")]),s._v(" 的排行榜，"),a("strong",[s._v("答题排行榜")]),s._v(" 等等。"),a("code",[s._v("Redis")]),s._v(" 提供了 "),a("strong",[s._v("列表")]),s._v("（"),a("code",[s._v("list")]),s._v("）和 "),a("strong",[s._v("有序集合")]),s._v("（"),a("code",[s._v("zset")]),s._v("）数据结构，合理的使用这些数据结构，可以很方便的构建各种排行榜系统。")]),s._v(" "),a("h3",{attrs:{id:"_2-3-计数器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-计数器"}},[s._v("#")]),s._v(" 2.3. 计数器")]),s._v(" "),a("p",[a("strong",[s._v("计数器")]),s._v(" 在网站应用中非常重要。例如："),a("strong",[s._v("点赞数")]),s._v("加 "),a("code",[s._v("1")]),s._v("，"),a("strong",[s._v("浏览数")]),s._v(" 加 "),a("code",[s._v("1")]),s._v("。还有常用的 "),a("strong",[s._v("限流操作")]),s._v("，限制每个用户每秒 "),a("strong",[s._v("访问系统的次数")]),s._v(" 等等。"),a("code",[s._v("Redis")]),s._v(" 支持 "),a("strong",[s._v("计数功能")]),s._v("（"),a("code",[s._v("INCR key")]),s._v("），而且计数的 "),a("strong",[s._v("性能")]),s._v(" 也非常好，计数的同时也可以设置 "),a("strong",[s._v("超时时间")]),s._v("，这样就可以 "),a("strong",[s._v("实现限流")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_2-4-社交网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-社交网络"}},[s._v("#")]),s._v(" 2.4. 社交网络")]),s._v(" "),a("p",[s._v("赞/踩，粉丝，共同好友/喜好，推送，下拉刷新等是社交网站必备的功能。由于社交网站 "),a("strong",[s._v("访问量通常比较大")]),s._v("，而且 "),a("strong",[s._v("传统的数据库")]),s._v(" 不太适合保存这类数据，"),a("code",[s._v("Redis")]),s._v(" 提供的 "),a("strong",[s._v("数据结构")]),s._v(" 可以相对比较容易实现这些功能。")]),s._v(" "),a("h3",{attrs:{id:"_2-5-消息队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-消息队列"}},[s._v("#")]),s._v(" 2.5. 消息队列")]),s._v(" "),a("p",[a("code",[s._v("Redis")]),s._v(" 提供的 "),a("strong",[s._v("发布订阅")]),s._v("（"),a("code",[s._v("PUB/SUB")]),s._v("）和 "),a("strong",[s._v("阻塞队列")]),s._v(" 的功能，虽然和专业的消息队列比，还 "),a("strong",[s._v("不够强大")]),s._v("，但对于一般的消息队列功能基本满足。")]),s._v(" "),a("h2",{attrs:{id:"_3-redis的安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-redis的安装配置"}},[s._v("#")]),s._v(" 3. Redis的安装配置")]),s._v(" "),a("p",[s._v("下面介绍一下 "),a("code",[s._v("Redis")]),s._v(" 的安装流程。我会按照如下的顺序，逐步搭建出 "),a("strong",[s._v("高可用")]),s._v(" 的 "),a("code",[s._v("Redis")]),s._v(" 缓存服务器集群。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("单机服务器")]),s._v(" 搭建")]),s._v(" "),a("li",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("主从复制")]),s._v(" 搭建")]),s._v(" "),a("li",[a("code",[s._v("Redis-Sentinel")]),s._v(" "),a("strong",[s._v("高可用")]),s._v(" 搭建")])]),s._v(" "),a("h3",{attrs:{id:"_3-1-redis单机服务器安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-redis单机服务器安装"}},[s._v("#")]),s._v(" 3.1. Redis单机服务器安装")]),s._v(" "),a("h4",{attrs:{id:"_3-1-1-下载并解压"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-下载并解压"}},[s._v("#")]),s._v(" 3.1.1. 下载并解压")]),s._v(" "),a("p",[s._v("首先从 "),a("code",[s._v("Redis")]),s._v(" 官网下载 "),a("code",[s._v("Redis")]),s._v(" 源代码并解压，这里使用的是 "),a("strong",[s._v("最新稳定版本")]),s._v(" "),a("code",[s._v("4.0.11")]),s._v("。依次执行如下命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/local/\nwget http://download.redis.io/releases/redis-4.0.11.tar.gz\ntar -zxvf redis-4.0.2.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-1-2-编译并安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-编译并安装"}},[s._v("#")]),s._v(" 3.1.2. 编译并安装")]),s._v(" "),a("p",[s._v("下载并解压完毕后，则对 "),a("strong",[s._v("源码包")]),s._v(" 进行 "),a("strong",[s._v("编译安装")]),s._v("，这里 "),a("code",[s._v("Redis")]),s._v(" 安装路径为 "),a("code",[s._v("/usr/local/redis")]),s._v("。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("："),a("code",[s._v("make install PREFIX")]),s._v("=目标安装路径")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/local/redis-4.0.11\nmake install PREFIX=/usr/local/redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("安装完成时，"),a("code",[s._v("/usr/local/redis/bin")]),s._v(" 目录下会生成的几个可执行的文件。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("可执行文件")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("redis-server")]),s._v(" "),a("td",[s._v("启动 redis 服务")])]),s._v(" "),a("tr",[a("td",[s._v("redis-cli redis")]),s._v(" "),a("td",[s._v("命令行客户端")])]),s._v(" "),a("tr",[a("td",[s._v("redis-benchmark")]),s._v(" "),a("td",[s._v("redis 基准测试工具")])]),s._v(" "),a("tr",[a("td",[s._v("redis-check-aof")]),s._v(" "),a("td",[s._v("redis AOF 持久化文件检测和修复工具")])]),s._v(" "),a("tr",[a("td",[s._v("redis-check-dump")]),s._v(" "),a("td",[s._v("redis RDB 持久化文件检测和修复工具")])]),s._v(" "),a("tr",[a("td",[s._v("redis-sentinel")]),s._v(" "),a("td",[s._v("启动 redis sentinel")])])])]),s._v(" "),a("p",[s._v("复制 "),a("code",[s._v("Redis")]),s._v(" 相关命令到 "),a("code",[s._v("/usr/local/bin")]),s._v(" 目录下，这样就可以直接执行这些命令，不用写全路径。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cd /usr/local/redis/bin/\n$ sudo sudo cp redis-cli redis-server redis-sentinel /usr/local/bin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-1-3-修改redis配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-修改redis配置文件"}},[s._v("#")]),s._v(" 3.1.3. 修改Redis配置文件")]),s._v(" "),a("p",[s._v("安装完成之后将 "),a("code",[s._v("Redis")]),s._v(" 配置文件拷贝到 "),a("code",[s._v("/usr/local")]),s._v(" 下，"),a("code",[s._v("redis.conf")]),s._v(" 是 "),a("code",[s._v("Redis")]),s._v(" 的配置文件，"),a("code",[s._v("redis.conf")]),s._v(" 在 "),a("code",[s._v("Redis")]),s._v(" 源码目录，"),a("code",[s._v("port")]),s._v(" 默认是 "),a("code",[s._v("6379")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo cp /usr/local/redis-4.0.11/redis.conf /usr/local/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("Redis")]),s._v(" 配置文件主要参数解析参考：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# redis进程是否以守护进程的方式运行，yes为是，no为否(不以守护进程的方式运行会占用一个终端)。\ndaemonize no\n# 指定redis进程的PID文件存放位置\npidfile /var/run/redis.pid\n# redis进程的端口号\nport 6379\n# 绑定的主机地址\nbind 127.0.0.1\n# 客户端闲置多长时间后关闭连接，默认此参数为0即关闭此功能\ntimeout 300\n# redis日志级别，可用的级别有debug.verbose.notice.warning\nloglevel verbose\n# log文件输出位置，如果进程以守护进程的方式运行，此处又将输出文件设置为stdout的话，就会将日志信息输出到/dev/null里面去了\nlogfile stdout\n# 设置数据库的数量，默认为0可以使用select <dbid>命令在连接上指定数据库id\ndatabases 16\n# 指定在多少时间内刷新次数达到多少的时候会将数据同步到数据文件\nsave <seconds> <changes>\n# 指定存储至本地数据库时是否压缩文件，默认为yes即启用存储\nrdbcompression yes\n# 指定本地数据库文件名\ndbfilename dump.db\n# 指定本地数据问就按存放位置\ndir ./\n# 指定当本机为slave服务时，设置master服务的IP地址及端口，在redis启动的时候他会自动跟master进行数据同步\nslaveof <masterip> <masterport>\n# 当master设置了密码保护时，slave服务连接master的密码\nmasterauth <master-password>\n# 设置redis连接密码，如果配置了连接密码，客户端在连接redis是需要通过AUTH<password>命令提供密码，默认关闭\nrequirepass footbared\n# 设置同一时间最大客户连接数，默认无限制。redis可以同时连接的客户端数为redis程序可以打开的最大文件描述符，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回 max number of clients reached 错误信息\nmaxclients 128\n# 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key。当此方法处理后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区\nmaxmemory<bytes>\n# 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no。\nappendonly no\n# 指定跟新日志文件名默认为appendonly.aof\nappendfilename appendonly.aof\n# 指定更新日志的条件，有三个可选参数 - no：表示等操作系统进行数据缓存同步到磁盘(快)，always：表示每次更新操作后手动调用fsync()将数据写到磁盘(慢，安全)， everysec：表示每秒同步一次(折衷，默认值)；\nappendfsync everysec\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("设置后台启动")])]),s._v(" "),a("p",[s._v("由于 "),a("code",[s._v("Redis")]),s._v(" 默认是 "),a("strong",[s._v("前台启动")]),s._v("，不建议使用。修改 "),a("code",[s._v("Redis")]),s._v(" 配置文件，把 "),a("code",[s._v("daemonize no")]),s._v(" 改为 "),a("code",[s._v("daemonize yes")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("daemonize yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("设置远程访问")])]),s._v(" "),a("p",[a("code",[s._v("Redis")]),s._v(" 默认只允许 "),a("strong",[s._v("本机访问")]),s._v("，把 "),a("code",[s._v("bind")]),s._v(" 修改为 "),a("code",[s._v("bind 0.0.0.0")]),s._v(" 此设置会变成 "),a("strong",[s._v("允许所有远程访问")]),s._v("。如果想指定限制访问，可设置对应的 "),a("code",[s._v("IP")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bind 0.0.0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("配置 "),a("code",[s._v("Redis")]),s._v(" 日志记录")])]),s._v(" "),a("p",[s._v("找到 "),a("code",[s._v("logfile")]),s._v(" 配置，默认是："),a("code",[s._v('logfile ""')]),s._v("，改为自定义日志文件路径。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("logfile /var/log/redis_6379.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("设置 "),a("code",[s._v("Redis")]),s._v(" 请求密码")])]),s._v(" "),a("p",[s._v("把 "),a("code",[s._v("requirepass")]),s._v(" 修改为 "),a("code",[s._v("123456")]),s._v("，修改之后重启下服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('requirepass "123456"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("有了密码之后，进入客户端，就得这样访问：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-1-4-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-redis"}},[s._v("#")]),s._v(" 3.1.4. Redis")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ redis-cli -h 127.0.0.1 -p 6379 -a 123456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"的常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#的常用命令"}},[s._v("#")]),s._v(" 的常用命令")]),s._v(" "),a("ul",[a("li",[s._v("启动命令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ redis-server /usr/local/redis.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("关闭命令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ redis-cli -h 127.0.0.1 -p 6379 shutdown\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("查看是否启动")])]),s._v(" "),a("p",[s._v("​")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ ps -ef | grep redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("进入客户端")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ redis-cli\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("关闭客户端")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ redis-cli shutdown\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("：不建议使用 "),a("code",[s._v("kill -9")]),s._v("，这种方式不但不会做持久化操作，还会造成缓冲区等资源不能优雅关闭。极端情况下造成 "),a("code",[s._v("AOF")]),s._v(" 和 "),a("strong",[s._v("复制丢失数据")]),s._v(" 的情况。"),a("code",[s._v("shutdown")]),s._v(" 还有一个参数，代表是否在关闭 "),a("code",[s._v("redis")]),s._v(" 前，生成 "),a("strong",[s._v("持久化文件")]),s._v("，命令为 "),a("code",[s._v("redis-cli shutdown nosave|save")]),s._v("。")])]),s._v(" "),a("ul",[a("li",[s._v("设置为开机自动启动")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ echo "redis-server /usr/local/redis.conf" >> /etc/rc.local\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("开放防火墙端口")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 添加规则\niptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT\n# 保存规则\nservice iptables save\n# 重启iptables\nservice iptables restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-1-5-注册redis为系统服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-注册redis为系统服务"}},[s._v("#")]),s._v(" 3.1.5. 注册Redis为系统服务")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/etc/init.d")]),s._v(" 目录下添加 "),a("code",[s._v("Redis")]),s._v(" 服务的 "),a("strong",[s._v("启动")]),s._v("，"),a("strong",[s._v("暂停")]),s._v(" 和 "),a("strong",[s._v("重启")]),s._v(" 脚本：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo /etc/init.d/redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("脚本的内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#!/bin/sh  \n#  \n# redis - this script starts and stops the redis-server daemon  \n#  \n# chkconfig:   - 85 15  \n# description:  Redis is a persistent key-value database  \n# processname: redis-server  \n# config:      /usr/local/redis/bin/redis-server\n# config:      /etc/redis.conf  \n# Source function library.  \n. /etc/rc.d/init.d/functions  \n# Source networking configuration.  \n. /etc/sysconfig/network  \n# Check that networking is up.  \n[ "$NETWORKING" = "no" ] && exit 0  \nredis="/usr/local/redis/bin/redis-server" \nprog=$(basename $redis)  \nREDIS_CONF_FILE="/etc/redis.conf" \n[ -f /etc/sysconfig/redis ] && . /etc/sysconfig/redis  \nlockfile=/var/lock/subsys/redis  \nstart() {  \n    [ -x $redis ] || exit 5  \n    [ -f $REDIS_CONF_FILE ] || exit 6  \n    echo -n $"Starting $prog: "  \n    daemon $redis $REDIS_CONF_FILE  \n    retval=$?  \n    echo  \n    [ $retval -eq 0 ] && touch $lockfile  \n    return $retval  \n}  \nstop() {  \n    echo -n $"Stopping $prog: "  \n    killproc $prog -QUIT  \n    retval=$?  \n    echo  \n    [ $retval -eq 0 ] && rm -f $lockfile  \n    return $retval  \n}  \nrestart() {  \n    stop  \n    start  \n}  \nreload() {  \n    echo -n $"Reloading $prog: "  \n    killproc $redis -HUP  \n    RETVAL=$?  \n    echo  \n}  \nforce_reload() {  \n    restart  \n}  \nrh_status() {  \n    status $prog  \n}  \nrh_status_q() {  \n    rh_status >/dev/null 2>&1  \n}  \ncase "$1" in  \n    start)  \n        rh_status_q && exit 0  \n        $1  \n        ;;  \n    stop)  \n        rh_status_q || exit 0  \n        $1  \n        ;;  \n    restart|configtest)  \n        $1  \n        ;;  \n    reload)  \n        rh_status_q || exit 7  \n        $1  \n        ;;  \n    force-reload)  \n        force_reload  \n        ;;  \n    status)  \n        rh_status  \n        ;;  \n    condrestart|try-restart)  \n        rh_status_q || exit 0  \n    ;;  \n    *)  \n        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|orce-reload}"  \n        exit 2  \nesac\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("赋予脚本文件可执行权限：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ chmod 755 /etc/init.d/redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动、停止和重启 "),a("code",[s._v("redis")]),s._v(" 服务：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("service redis start\nservice redis stop\nservice redis restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_3-2-redis主从复制集群安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-redis主从复制集群安装"}},[s._v("#")]),s._v(" 3.2. Redis主从复制集群安装")]),s._v(" "),a("h4",{attrs:{id:"_3-2-1-redis-server配置说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-redis-server配置说明"}},[s._v("#")]),s._v(" 3.2.1. Redis-Server配置说明")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("角色")]),s._v(" "),a("th",[s._v("IP地址")]),s._v(" "),a("th",[s._v("端口号")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Redis Master")]),s._v(" "),a("td",[s._v("10.206.20.231")]),s._v(" "),a("td",[s._v("16379")])]),s._v(" "),a("tr",[a("td",[s._v("Redis Slave")]),s._v(" "),a("td",[s._v("10.206.20.231")]),s._v(" "),a("td",[s._v("26379")])])])]),s._v(" "),a("h4",{attrs:{id:"_3-2-2-redis主从架构配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-redis主从架构配置"}},[s._v("#")]),s._v(" 3.2.2. Redis主从架构配置")]),s._v(" "),a("ul",[a("li",[s._v("编辑 "),a("strong",[s._v("从机")]),s._v(" 的 "),a("code",[s._v("Redis")]),s._v(" 配置文件，找到 "),a("code",[s._v("210")]),s._v(" 行（大概）- "),a("code",[s._v("#slaveof <masterip> <masterport>")]),s._v(" 。去掉该注释，填写 "),a("strong",[s._v("主服务器")]),s._v(" 的 "),a("code",[s._v("IP")]),s._v(" 和 "),a("strong",[s._v("端口")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("slaveof 10.206.20.231 16379\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("如果 "),a("strong",[s._v("主服务器")]),s._v(" 设置了密码，还需要找到 "),a("code",[s._v("masterauth <master-password>")]),s._v(" 这一行，去掉注释，改为 "),a("code",[s._v("masterauth")]),s._v(" 的主机密码。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("masterauth 123456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("配置完成后重启 "),a("strong",[s._v("从服务器")]),s._v(" 的 "),a("code",[s._v("Redis")]),s._v(" 服务。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ service redis restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("重启完成之后，进入 "),a("strong",[s._v("主服务器")]),s._v(" 的 "),a("code",[s._v("redis-cli")]),s._v(" 模式下，命令为 "),a("code",[s._v("redis-cli -h 127.0.0.1 -p 16379 -a 123456")]),s._v("。输入 "),a("code",[s._v("INFO replication")]),s._v(" 查询到 "),a("strong",[s._v("当前主机")]),s._v(" 的 "),a("code",[s._v("Redis")]),s._v(" 的状态，连接上 "),a("strong",[s._v("主服务器")]),s._v(" 的 "),a("strong",[s._v("从服务器")]),s._v("。")])]),s._v(" "),a("p",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("主服务器")]),s._v(" 的配置文件：")]),s._v(" "),a("ul",[a("li",[s._v("redis.conf")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("daemonize yes\npidfile /var/run/redis-16379.pid\nlogfile /var/log/redis/redis-16379.log\nport 16379\nbind 0.0.0.0\ntimeout 300\ndatabases 16\ndbfilename dump-16379.db\ndir ./redis-workdir\nmasterauth 123456\nrequirepass 123456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("从服务器")]),s._v(" 的配置文件：")]),s._v(" "),a("ul",[a("li",[s._v("redis.conf")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("daemonize yes\npidfile /var/run/redis-26379.pid\nlogfile /var/log/redis/redis-26379.log\nport 26379\nbind 0.0.0.0\ntimeout 300\ndatabases 16\ndbfilename dump-26379.db\ndir ./redis-workdir\nmasterauth 123456\nrequirepass 123456\nslaveof 127.0.0.1 16379\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("主服务器")]),s._v(" 的状态如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=10.206.20.231,port=16379,state=online,offset=28,lag=1\nmaster_replid:625ae9f362643da5337835beaeabfdca426198c7\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:28\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:28\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("code",[s._v("Redis")]),s._v(" "),a("strong",[s._v("从服务器")]),s._v(" 的状态如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Replication\nrole:slave\nmaster_host:10.206.20.231\nmaster_port:26379\nmaster_link_status:up\nmaster_last_io_seconds_ago:3\nmaster_sync_in_progress:0\nslave_repl_offset:210\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_replid:625ae9f362643da5337835beaeabfdca426198c7\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:210\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:210\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_3-2-3-redis主从配置验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-redis主从配置验证"}},[s._v("#")]),s._v(" 3.2.3. Redis主从配置验证")]),s._v(" "),a("p",[s._v("上面完成了基本的 "),a("strong",[s._v("主从配置")]),s._v("，可以简单的测试一下效果：")]),s._v(" "),a("ul",[a("li",[s._v("进入 "),a("strong",[s._v("主服务器")]),s._v(" 的 "),a("code",[s._v("redis-cli")]),s._v(" 模式，然后 "),a("code",[s._v("set")]),s._v(" 一个值，比如：")])]),s._v(" "),a("p",[s._v("​")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('> set master_port "16379"\nOK\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("切换进入 "),a("strong",[s._v("从服务器")]),s._v(" 的 "),a("code",[s._v("redis-cli")]),s._v(" 的模式，查询刚刚设置的值看是否存在：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('> get master_port\n"16379"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("此时，我们可以发现是可以获取到值的，"),a("code",[s._v("Redis")]),s._v(" 的 "),a("strong",[s._v("主从模式")]),s._v(" 正常工作。")]),s._v(" "),a("p",[s._v("有问题可以讨论，欢迎大家和我一起学习微信hsj179540")])])}),[],!1,null,null,null);e.default=r.exports}}]);