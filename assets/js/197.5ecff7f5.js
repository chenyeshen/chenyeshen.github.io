(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{842:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"seata分布式事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#seata分布式事务"}},[s._v("#")]),s._v(" "),e("strong",[s._v("seata分布式事务")])]),s._v(" "),e("h3",{attrs:{id:"oolun版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oolun版本"}},[s._v("#")]),s._v(" ooLun版本")]),s._v(" "),e("ul",[e("li",[s._v("V2.7.0+")])]),s._v(" "),e("h3",{attrs:{id:"系统中暂未用到分布式事务，默认情况下无需启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统中暂未用到分布式事务，默认情况下无需启动"}},[s._v("#")]),s._v(" 系统中暂未用到分布式事务，默认情况下无需启动")]),s._v(" "),e("h3",{attrs:{id:"详情"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#详情"}},[s._v("#")]),s._v(" 详情")]),s._v(" "),e("ul",[e("li",[s._v("Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。Seata 将为用户提供了 AT、TCC、SAGA 和 XA 事务模式，为用户打造一站式的分布式解决方案。"),e("a",{attrs:{href:"https://seata.io/zh-cn/docs/overview/what-is-seata.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方地址"),e("OutboundLink")],1)]),s._v(" "),e("li",[s._v("实例说明")])]),s._v(" "),e("p",[e("a",{attrs:{href:"https://joolun-blog.oss-cn-zhangjiakou.aliyuncs.com/git/20200430173562654.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://joolun-blog.oss-cn-zhangjiakou.aliyuncs.com/git/20200430173562654.png",alt:"img"}}),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("上图所示，当请求A服务时\n1. A服务做增删改操作完\n1. 使用Feign调用B服务\n1. B服务做增删改操作完\n1. 合并1、3两步操作\n2. 返回处理结果\n\n异常分析\n1. 步骤1发生异常，spring 事务会自动回滚\n1. 步骤2发生异常，spring 事务会自动回滚\n1. 步骤3发生异常，3会自动回滚，根据返回的自定义异常1会自动回滚\n1. 步骤4发生异常，spring事务会自动回滚 ，***但是3的操作不会回滚***\n\n分布式事务的作用就是当A模块开启事务时，如果步骤4发生异常，3的操作也要回滚\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("JooLun中分布式事务的使用")]),s._v(" "),e("p",[s._v("1、在两个服务的pom中引入事务管理依赖")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\x3c!--分布式事务--\x3e\n<dependency>\n    <groupId>com.joolun</groupId>\n    <artifactId>base-common-transaction</artifactId>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("2、在A服务需要开启事务的方法上加上@GlobalTransactional注解")]),s._v(" "),e("p",[s._v("3、添加服务配置（joolun\\server\\seata-server\\conf\\file.conf）")]),s._v(" "),e("p",[e("code",[s._v('vgroupMapping.服务名-seata-service-group = "default"')])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('service {\n  #transaction service group mapping\n  vgroupMapping.base-mall-admin-seata-service-group = "default"\n  vgroupMapping.base-weixin-admin-seata-service-group = "default"\n  #only support when registry.type=file, please don\'t set multiple addresses\n  default.grouplist = "127.0.0.1:8091"\n  #degrade, current not support\n  enableDegrade = false\n  #disable seata\n  disableGlobalTransaction = false\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("启动seata-server服务端（joolun/server/seata-server/bin）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("window系统启动双击seata-server.bat\n\nlinux系统启动运行seata-server.sh，命令如下\n  \n`nohup sh ./server/seata-server/bin/seata-server.sh >base-seata.out &`\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("再重启各服务")])])])])}),[],!1,null,null,null);a.default=t.exports}}]);