(window.webpackJsonp=window.webpackJsonp||[]).push([[228],{873:function(s,e,a){"use strict";a.r(e);var n=a(4),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"安装openssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装openssl"}},[s._v("#")]),s._v(" 安装Openssl")]),s._v(" "),a("p",[s._v("下载地址：http://slproweb.com/products/Win32OpenSSL.html （根据系统选择32位或者64位版本下载安装）。")]),s._v(" "),a("p",[s._v("下载完成后，进行安装，我安装在了 C:\\wnmp\\OpenSSL-Win64文件夹中。")]),s._v(" "),a("h2",{attrs:{id:"配置环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[s._v("#")]),s._v(" 配置环境变量")]),s._v(" "),a("p",[s._v("在环境变量中添加环境变量")]),s._v(" "),a("p",[s._v("变量名：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("OPENSSL_HOME\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("变量值：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\wnmp\\OpenSSL-Win64\\bin;     （变量值为openssl安装位置）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在path变量结尾添加如下 ：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" %OPENSSL_HOME%;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"生成证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[s._v("#")]),s._v(" 生成证书")]),s._v(" "),a("h3",{attrs:{id:"（1）-首先在-nginx安装目录中创建ssl文件夹用于存放证书。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（1）-首先在-nginx安装目录中创建ssl文件夹用于存放证书。"}},[s._v("#")]),s._v(" （1） 首先在 nginx安装目录中创建ssl文件夹用于存放证书。")]),s._v(" "),a("p",[s._v("比如我的文件目录为 C:\\wnmp\\nginx\\ssl")]),s._v(" "),a("p",[s._v("以管理员身份进入命令行模式，进入ssl文件夹。 命令为： "),a("strong",[s._v("cd  c:/wnmp/nginx/ssl")])]),s._v(" "),a("h3",{attrs:{id:"（2）-创建私钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（2）-创建私钥"}},[s._v("#")]),s._v(" （2） 创建私钥")]),s._v(" "),a("p",[s._v("在命令行中执行命令： "),a("strong",[s._v("openssl genrsa -des3 -out lee.key 1024")]),s._v("   （lee文件名可以自定义），如下图所示：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907224828051-420516602.png",alt:"img"}})]),s._v(" "),a("p",[s._v("输入密码后，再次重复输入确认密码。记住此密码，后面会用到。")]),s._v(" "),a("h3",{attrs:{id:"（3）创建csr证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（3）创建csr证书"}},[s._v("#")]),s._v(" （3）创建csr证书")]),s._v(" "),a("p",[s._v("在命令行中执行命令： "),a("strong",[s._v("openssl req -new -key lee.key -out lee.csr")]),s._v("   （key文件为刚才生成的文件，lee为自定义文件名）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907225201738-1540923123.png",alt:"img"}})]),s._v(" "),a("p",[s._v("如上图所示，执行上述命令后，需要输入信息。"),a("strong",[s._v("输入的信息中最重要的为 Common Name，这里输入的域名即为我们要使用https访问的域名。")])]),s._v(" "),a("p",[s._v("以上步骤完成后，ssl文件夹内出现两个文件："),a("img",{attrs:{src:"https://images2015.cnblogs.com/blog/844352/201609/844352-20160907225449613-1993871809.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"（4）去除密码。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（4）去除密码。"}},[s._v("#")]),s._v(" （4）去除密码。")]),s._v(" "),a("p",[s._v("在加载SSL支持的Nginx并使用上述私钥时除去必须的口令，否则会在启动nginx的时候需要输入密码。")]),s._v(" "),a("p",[s._v("复制lee.key并重命名为lee.key.org")]),s._v(" "),a("p",[s._v("可以使用此命令行，也可以使用鼠标操作   "),a("strong",[s._v("copy lee.key lee.key.org")])]),s._v(" "),a("p",[s._v("去除口令，在命令行中执行此命令： "),a("strong",[s._v("openssl rsa -in lee.key.org -out lee.key")]),s._v("  （lee为自定义文件名）")]),s._v(" "),a("p",[s._v("如下图所示，此命令需要输入刚才设置的密码。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907225931629-1434233040.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"（5）生成crt证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#（5）生成crt证书"}},[s._v("#")]),s._v(" （5）生成crt证书")]),s._v(" "),a("p",[s._v("在命令行中执行此命令： "),a("strong",[s._v("openssl x509 -req -days 365 -in lee.csr -signkey lee.key -out lee.crt")]),s._v("  （lee为自定义文件名）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907230105504-1874769271.png",alt:"img"}})]),s._v(" "),a("p",[s._v("证书生成完毕，ssl文件夹中一共生成如下4个文件，我们需要使用到的是lee.crt和lee.key。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907230134707-1345377777.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"修改nginx-conf文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx-conf文件"}},[s._v("#")]),s._v(" 修改nginx.conf文件")]),s._v(" "),a("p",[s._v("nginx.conf文件位于：C:\\wnmp\\nginx\\conf")]),s._v(" "),a("p",[s._v("找到该文件中如下代码的位置进行修改： 保证本机的端口不被占用 443 和 80")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("修改为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# HTTPS server\n    server {\n        listen       9443 ssl;\n        server_name    localhost;\n    \n        ssl_certificate      C:/wnmp/nginx/ssl/lee.crt;\n        ssl_certificate_key  C:/wnmp/nginx/ssl/lee.key;\n    \n        #ssl_session_cache    shared:SSL:1m;\n        #ssl_session_timeout  5m;\n\n        #ssl_ciphers  HIGH:!aNULL:!MD5;\n        #ssl_prefer_server_ciphers  on;\n\n        location / {\n                proxy_pass http://localhost:8080;\n        }\n\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h2",{attrs:{id:"重启nginx。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx。"}},[s._v("#")]),s._v(" 重启nginx。")]),s._v(" "),a("p",[s._v("在浏览器中，访问 https://www.lee.com。发现出现证书认证，并能够成功访问。（www.lee.com为生成证书时，Common Name输入的域名）")]),s._v(" "),a("p",[s._v("（执行此步骤时，需要配置好Virtual Host，并且在www.lee.com开放目录中添加了index.php默认入口访问文件。）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/daixiaomao/Images/raw/master/img/844352-20160907232253410-1811674172.png",alt:"img"}})]),s._v(" "),a("p",[s._v("上面的https被红色划线是因为我们使用的是自己生成的证书，此证书不受浏览器信任，如果想使其变为绿色，则需要向证书管理机构进行申请。")]),s._v(" "),a("h2",{attrs:{id:"添加重定向，自动跳转使用https。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加重定向，自动跳转使用https。"}},[s._v("#")]),s._v(" 添加重定向，自动跳转使用https。")]),s._v(" "),a("p",[s._v("在nginx.conf中virtual host中如下代码位置添加一行代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    listen       80;                    \n    server_name   www.lee.com;                    \n#modify by lee 20160907 for https Redirect -s                        \n    rewrite ^(.*) https://$server_name$1 permanent;                    \n#modify by lee 20160907 for https Redirect -e                        \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"重启nginx。-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx。-2"}},[s._v("#")]),s._v(" 重启nginx。")]),s._v(" "),a("p",[s._v("访问www.lee.com，会发现浏览器自动跳转到https://www.lee.com，并能够成功访问。")]),s._v(" "),a("p",[s._v("至此，https访问配置成功完成。")])])}),[],!1,null,null,null);e.default=t.exports}}]);