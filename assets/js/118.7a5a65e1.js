(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{763:function(s,n,a){"use strict";a.r(n);var t=a(4),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-nignx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-nignx配置"}},[s._v("#")]),s._v(" 一.nignx配置")]),s._v(" "),a("p",[s._v("因为涉及到支付的业务，为了安全，现将一些https请求利用nginx代理到http接口上，也就是用nginx实现本地https请求转http请求")]),s._v(" "),a("h3",{attrs:{id:"_1-1-开启nginx的ssl模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-开启nginx的ssl模块"}},[s._v("#")]),s._v(" 1.1 开启Nginx的SSL模块")]),s._v(" "),a("p",[s._v("下载nginx和安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum install gcc cc wget openssl openssl-devel pcre pcre-devel -y\ncd /usr/local\nwget http://nginx.org/download/nginx-1.14.0.tar.gz\ntar -zxvf nginx-1.14.0.tar.gz\n/usr/local/nginx/sbin/nginx -V\ncd nginx-1.14.0\n#添加ssl加密模块，需重新编译模块\n./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module\nmake & make install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_1-2-生成测试证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-生成测试证书"}},[s._v("#")]),s._v(" 1.2 生成测试证书")]),s._v(" "),a("ul",[a("li",[s._v("使用openssl生成密钥privkey.pem：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir /usr/local/nginx/ssl \ncd /usr/local/nginx/ssl \nopenssl genrsa -out privkey.pem 1024/2038\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("使用密钥生成证书server.pem：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@localhost ssl]# openssl req -new -x509 -key privkey.pem -out server.crt -days 365\n-----\nCountry Name (2 letter code) [XX]:cn\nState or Province Name (full name) []:guangdong\nLocality Name (eg, city) [Default City]:guangzhou\nOrganization Name (eg, company) [Default Company Ltd]:gzstrong.com\nOrganizational Unit Name (eg, section) []:601\nCommon Name (eg, your name or your server's hostname) []:cjh\nEmail Address []:cjh@qq.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("证书信息可以随便填或者留空，只有Common Name要根据你的域名填写。如gzstrong.com，或使用*.gzstrong.com匹配二级域名。")]),s._v(" "),a("h3",{attrs:{id:"_1-3-ngnix配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ngnix配置"}},[s._v("#")]),s._v(" 1.3 ngnix配置")]),s._v(" "),a("p",[s._v("在http模块里面加入server端口为443的配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    server{\n        listen 443 ssl;\n        server_name zhifu.gzstrong.com;\n        ssl_certificate /usr/local/nginx/ssl/server.crt;\n        ssl_certificate_key /usr/local/nginx/ssl/privkey.pem;\n        ssl_session_timeout 5m;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n        location / {\n            root html;\n            index index.html;\n            client_max_body_size 500m;\n        }\n        location /pay/ {\n            proxy_pass http://127.0.0.1:3020/;\n            proxy_set_header Host $http_host;\n            client_max_body_size 500m;\n        }\n     }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("其他代理")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /mch/ {\n    proxy_pass http://127.0.0.1:8191/;\n    proxy_set_header Host $http_host;\n    client_max_body_size 500m;\n}\nlocation /doc/ {\n    proxy_pass http://127.0.0.1:8191/;\n    proxy_set_header Host $http_host;\n    client_max_body_size 500m;\n}\nlocation /agent/ {\n    proxy_pass http://127.0.0.1:8192/;\n    proxy_set_header Host $http_host;\n    client_max_body_size 500m;\n}\nlocation /mgr/ {\n    proxy_pass http://127.0.0.1:8193/;\n    proxy_set_header Host $http_host;\n    client_max_body_size 500m;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);